<!DOCTYPE html>
<html>
<head>
    <title>Teste Socket.IO</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
</head>
<body>
    <h1>Teste de ConexÃ£o Socket.IO</h1>
    <div id="status">Conectando...</div>
    <div id="logs"></div>
    
    <script>
        const log = (msg) => {
            const logs = document.getElementById('logs');
            logs.innerHTML += `<p>${new Date().toLocaleTimeString()}: ${msg}</p>`;
            console.log(msg);
        };

        // Conectar ao socket
        const socket = io('http://localhost:3001', {
            query: { userId: 'test-user-123' },
            transports: ['websocket', 'polling']
        });

        socket.on('connect', () => {
            document.getElementById('status').innerHTML = 'âœ… CONECTADO! Socket ID: ' + socket.id;
            log('âœ… Socket conectado com sucesso!');
            
            // Entrar em uma sala de teste
            socket.emit('join_conversation', 'test-conversation');
            log('ðŸ“¨ Enviado: join_conversation');
        });

        socket.on('connect_error', (error) => {
            document.getElementById('status').innerHTML = 'âŒ ERRO DE CONEXÃƒO';
            log('âŒ Erro de conexÃ£o: ' + error.message);
        });

        socket.on('disconnect', (reason) => {
            document.getElementById('status').innerHTML = 'âš ï¸ DESCONECTADO';
            log('âš ï¸ Desconectado: ' + reason);
        });

        // Listener para qualquer evento
        socket.onAny((eventName, ...args) => {
            log(`ðŸ“¡ Evento recebido: ${eventName} - ${JSON.stringify(args)}`);
        });

        // Teste: enviar mensagem apÃ³s 2 segundos
        setTimeout(() => {
            log('ðŸ“¤ Tentando enviar mensagem de teste...');
            socket.emit('send_message', {
                conversationId: 'test-conversation',
                messageData: {
                    content: 'Teste de mensagem',
                    type: 'text'
                }
            });
        }, 2000);
    </script>
</body>
</html>
