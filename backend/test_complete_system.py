#!/usr/bin/env python3\n# -*- coding: utf-8 -*-\n\"\"\"\nTeste Completo do Sistema de Valida√ß√£o Robusto - Solidar Bairro\n\"\"\"\n\nimport json\nimport sys\nimport os\n\n# Adiciona o diret√≥rio atual ao path\nsys.path.append(os.path.dirname(os.path.abspath(__file__)))\n\nfrom solidar_bot_robust import SolidarBotRobust\n\ndef run_comprehensive_tests():\n    \"\"\"Executa testes abrangentes do sistema\"\"\"\n    bot = SolidarBotRobust()\n    \n    test_cases = [\n        {\n            'name': '‚úÖ Pedido V√°lido - Alimentos Cr√≠tico',\n            'data': {\n                'category': 'Alimentos',\n                'description': 'Preciso urgentemente de ajuda com comida para minha fam√≠lia. Somos 4 pessoas, tenho 2 filhos pequenos de 3 e 5 anos. Estou desempregado h√° 3 meses e nossa situa√ß√£o est√° muito dif√≠cil. N√£o temos o que comer hoje e as crian√ßas est√£o com fome.',\n                'urgency': 'critico'\n            },\n            'expected': True\n        },\n        {\n            'name': '‚ùå Spam Detectado',\n            'data': {\n                'category': 'Alimentos',\n                'description': 'dawdawdaw dawdawdaw preciso ajuda dawdawdaw dawdawdaw',\n                'urgency': 'urgente'\n            },\n            'expected': False\n        },\n        {\n            'name': '‚ùå Categoria Incorreta',\n            'data': {\n                'category': 'Medicamentos',\n                'description': 'Preciso de comida para meus filhos, estamos com fome h√° dias. N√£o temos nada para comer em casa.',\n                'urgency': 'critico'\n            },\n            'expected': False\n        },\n        {\n            'name': '‚ùå Urg√™ncia Inconsistente',\n            'data': {\n                'category': 'Contas',\n                'description': 'Preciso pagar o aluguel quando poss√≠vel, sem pressa, pode ser qualquer dia.',\n                'urgency': 'critico'\n            },\n            'expected': False\n        },\n        {\n            'name': '‚ùå Texto Muito Curto',\n            'data': {\n                'category': 'Roupas',\n                'description': 'Preciso roupa',\n                'urgency': 'moderada'\n            },\n            'expected': False\n        },\n        {\n            'name': '‚úÖ Pedido V√°lido - Medicamentos',\n            'data': {\n                'category': 'Medicamentos',\n                'description': 'Minha m√£e idosa de 75 anos precisa de rem√©dios para press√£o alta. Ela est√° sem o medicamento h√° 3 dias e estou preocupado. N√£o tenho dinheiro para comprar na farm√°cia.',\n                'urgency': 'urgente'\n            },\n            'expected': True\n        },\n        {\n            'name': '‚ùå Contexto Pessoal Insuficiente',\n            'data': {\n                'category': 'Emprego',\n                'description': 'Preciso de trabalho para ganhar dinheiro e pagar as contas.',\n                'urgency': 'moderada'\n            },\n            'expected': False\n        },\n        {\n            'name': '‚úÖ Pedido V√°lido - Moradia',\n            'data': {\n                'category': 'Moradia',\n                'description': 'Estou com risco de despejo. Tenho 2 filhos pequenos e n√£o consegui pagar o aluguel deste m√™s. O propriet√°rio j√° enviou notifica√ß√£o e temos 10 dias para sair. Preciso de ajuda urgente.',\n                'urgency': 'critico'\n            },\n            'expected': True\n        },\n        {\n            'name': '‚ùå Indicadores Falsos - Festa',\n            'data': {\n                'category': 'Alimentos',\n                'description': 'Preciso de comida para uma festa de anivers√°rio que vou fazer para meus filhos.',\n                'urgency': 'moderada'\n            },\n            'expected': False\n        },\n        {\n            'name': '‚úÖ Pedido V√°lido - Transporte',\n            'data': {\n                'category': 'Transporte',\n                'description': 'Preciso de ajuda com passagem de √¥nibus para levar minha filha ao m√©dico. Ela tem consulta marcada e n√£o tenho dinheiro para o transporte. √â uma consulta importante para o tratamento dela.',\n                'urgency': 'urgente'\n            },\n            'expected': True\n        }\n    ]\n    \n    print(\"ü§ñ TESTE COMPLETO DO SISTEMA DE VALIDA√á√ÉO ROBUSTO\")\n    print(\"=\" * 70)\n    print(f\"üìä Total de testes: {len(test_cases)}\\n\")\n    \n    passed = 0\n    failed = 0\n    \n    for i, test_case in enumerate(test_cases, 1):\n        print(f\"üß™ Teste {i:2d}: {test_case['name']}\")\n        print(\"-\" * 50)\n        \n        try:\n            result = bot.validate_request(test_case['data'])\n            \n            # Verifica se o resultado est√° correto\n            test_passed = result['isValid'] == test_case['expected']\n            \n            if test_passed:\n                print(\"‚úÖ PASSOU\")\n                passed += 1\n            else:\n                print(\"‚ùå FALHOU\")\n                failed += 1\n                print(f\"   Esperado: {test_case['expected']}, Obtido: {result['isValid']}\")\n            \n            # Mostra m√©tricas\n            print(f\"   üìà Confian√ßa: {result['confidence']}%\")\n            print(f\"   ‚ö†Ô∏è  Risco: {result['riskScore']}%\")\n            print(f\"   üìù An√°lise: {result['analysis']}\")\n            \n            # Mostra sugest√µes se houver\n            if result['suggestions']:\n                print(f\"   üí° Sugest√µes: {len(result['suggestions'])}\")\n                for suggestion in result['suggestions'][:2]:  # Mostra apenas as 2 primeiras\n                    print(f\"      - {suggestion['message']}\")\n            \n            # Mostra valida√ß√µes que falharam\n            failed_validations = [k for k, v in result['validations'].items() if not v['isValid']]\n            if failed_validations:\n                print(f\"   ‚ùå Falhas: {', '.join(failed_validations)}\")\n            \n        except Exception as e:\n            print(f\"‚ùå ERRO: {str(e)}\")\n            failed += 1\n        \n        print()\n    \n    # Resumo final\n    print(\"=\" * 70)\n    print(\"üìä RESUMO DOS TESTES\")\n    print(f\"‚úÖ Passou: {passed}/{len(test_cases)} ({passed/len(test_cases)*100:.1f}%)\")\n    print(f\"‚ùå Falhou: {failed}/{len(test_cases)} ({failed/len(test_cases)*100:.1f}%)\")\n    \n    if passed == len(test_cases):\n        print(\"\\nüéâ TODOS OS TESTES PASSARAM! Sistema funcionando perfeitamente.\")\n    elif passed >= len(test_cases) * 0.8:\n        print(\"\\n‚úÖ Sistema funcionando bem, mas h√° algumas melhorias a fazer.\")\n    else:\n        print(\"\\n‚ö†Ô∏è Sistema precisa de ajustes. Verifique as falhas.\")\n    \n    return passed, failed\n\ndef test_categories():\n    \"\"\"Testa todas as categorias\"\"\"\n    bot = SolidarBotRobust()\n    \n    print(\"\\nüè∑Ô∏è TESTE DE CATEGORIAS\")\n    print(\"=\" * 40)\n    \n    categories = list(bot.categories.keys())\n    print(f\"üìã Categorias suportadas: {len(categories)}\")\n    \n    for category in categories:\n        keywords = bot.categories[category]['keywords'][:3]  # Primeiras 3 palavras\n        print(f\"   {category}: {', '.join(keywords)}...\")\n    \n    print()\n\ndef test_performance():\n    \"\"\"Testa performance do sistema\"\"\"\n    import time\n    \n    bot = SolidarBotRobust()\n    \n    print(\"‚ö° TESTE DE PERFORMANCE\")\n    print(\"=\" * 30)\n    \n    test_data = {\n        'category': 'Alimentos',\n        'description': 'Preciso de ajuda com comida para minha fam√≠lia. Temos 3 filhos e estou desempregado.',\n        'urgency': 'urgente'\n    }\n    \n    # Teste de velocidade\n    start_time = time.time()\n    result = bot.validate_request(test_data)\n    end_time = time.time()\n    \n    processing_time = end_time - start_time\n    print(f\"‚è±Ô∏è Tempo de processamento: {processing_time:.2f}s\")\n    \n    if processing_time < 3:\n        print(\"‚úÖ Performance excelente\")\n    elif processing_time < 5:\n        print(\"‚úÖ Performance boa\")\n    else:\n        print(\"‚ö†Ô∏è Performance pode ser melhorada\")\n    \n    print()\n\nif __name__ == '__main__':\n    print(\"üöÄ Iniciando testes do sistema...\\n\")\n    \n    # Testa categorias\n    test_categories()\n    \n    # Testa performance\n    test_performance()\n    \n    # Executa testes principais\n    passed, failed = run_comprehensive_tests()\n    \n    # C√≥digo de sa√≠da\n    sys.exit(0 if failed == 0 else 1)